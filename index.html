<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OBEAR æ˜Ÿéš›å­¸é™¢ v7.9.1 (è©³è§£ä¿®å¾©ç‰ˆ)</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root {
            --brand-primary: #00509B;
            --brand-success: #78C878;
            --bg-color: #f0f4f8;
            --text-main: #2c3e50;
            --accent-red: #e74c3c;
            --accent-gold: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-color);
            margin: 0; padding: 0; color: var(--text-main);
            height: 100vh; height: 100dvh; 
            width: 100vw;
            display: flex; flex-direction: column;
            overflow: hidden; 
            user-select: none; -webkit-tap-highlight-color: transparent;
        }

        /* RWD å®¹å™¨è¨­å®š */
        .screen { 
            display: none; 
            flex-direction: column; 
            width: 100%; 
            height: 100%; 
            padding: 20px; 
            box-sizing: border-box; 
            align-items: center; 
            position: relative; 
            overflow-y: auto; 
            overflow-x: hidden;
        }
        .screen.active { display: flex; }
        
        #screen-login { justify-content: center; }
        @media (max-height: 600px) { #screen-login { justify-content: flex-start; } }

        .btn { background: var(--brand-primary); color: white; border: none; padding: 12px 24px; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin: 5px; box-shadow: 0 4px 0 #003366; transition: transform 0.1s; flex-shrink: 0; }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-green { background: var(--brand-success); box-shadow: 0 4px 0 #5da35d; }
        .btn-red { background: var(--accent-red); box-shadow: 0 4px 0 #c0392b; }
        .btn-light { background: white; color: var(--brand-primary); border: 2px solid #ccc; }

        .course-selector {
            width: 85%; max-width: 300px; padding: 12px; font-size: 1.1rem; 
            border-radius: 12px; border: 2px solid #f1c40f; 
            background: white; color: #333; font-weight: bold;
            margin-bottom: 20px; text-align: center; outline: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        /* åœ–ç‰‡èˆ‡å‹•ç•« */
        .monster-stage { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; min-height: 200px; }
        .monster-img { width: auto; height: auto; max-width: 80%; max-height: 220px; object-fit: contain; animation: breathe 3s infinite ease-in-out; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02) translateY(-2px); } }

        /* ç‹€æ…‹å¡ */
        .status-card { background: white; border-radius: 16px; padding: 10px; width: 95%; max-width: 350px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 10px; flex-shrink: 0; }
        .stats-row { display: flex; justify-content: space-around; margin: 5px 0; background: #f8f9fa; padding: 5px; border-radius: 8px; }
        .stat-box { text-align: center; font-size: 0.8rem; font-weight: bold; }
        .stat-val { font-size: 1.1rem; color: #333; }
        .bar-container { background: #eee; height: 10px; border-radius: 5px; width: 100%; margin: 5px 0; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.5s ease-out; }
        .bar-hp { background: var(--accent-red); }
        .bar-exp { background: var(--brand-success); }

        /* æˆ°é¬¥ç•«é¢ */
        #screen-battle { justify-content: space-between; padding: 0; background: #2c3e50; overflow: hidden; }
        .battle-half { flex: 1; width: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; overflow: hidden; }
        .battle-top { background: rgba(0,0,0,0.2); border-bottom: 2px solid rgba(255,255,255,0.1); }
        .battle-bottom { background: transparent; }
        
        .battle-avatar { max-height: 50%; width: auto; object-fit: contain; transition: transform 0.1s; filter: drop-shadow(0 0 10px rgba(0,0,0,0.5)); display: block; }
        .battle-info { color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8); font-weight: bold; margin: 5px 0; width: 80%; text-align: center; }
        
        .battle-controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; }
        .battle-msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; pointer-events: none; z-index: 10; width: 80%; text-align: center;}

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; display: none; justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(5px); }
        
        /* â–¼â–¼â–¼ é—œéµä¿®æ­£ï¼šå¼·åˆ¶æ‹‰é«˜è©³è§£è¦–çª—å±¤ç´šï¼Œé¿å…è¢«é®æ“‹ â–¼â–¼â–¼ */
        #modal-explanation { z-index: 3000 !important; }

        .quiz-box { background: white; padding: 20px; border-radius: 20px; width: 100%; max-width: 450px; text-align: center; max-height: 90vh; overflow-y: auto; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .opt-btn { background: #f8f9fa; border: 2px solid #e9ecef; color: #333; padding: 15px; border-radius: 10px; font-size: 1.1rem; cursor: pointer; font-weight: bold; height: 80px; display: flex; align-items: center; justify-content: center; transition: background 0.2s; }

        /* å‹•ç•« */
        .anim-atk-up { animation: atkUp 1.0s ease-in-out; }
        @keyframes atkUp { 0% { transform: translateY(0); } 40% { transform: translateY(50px) scale(0.9); } 60% { transform: translateY(-200px) scale(1.2); } 100% { transform: translateY(0); } }
        .anim-atk-down { animation: atkDown 1.0s ease-in-out; }
        @keyframes atkDown { 0% { transform: translateY(0); } 40% { transform: translateY(-50px) scale(0.9); } 60% { transform: translateY(200px) scale(1.2); } 100% { transform: translateY(0); } }
        .anim-dmg { animation: shakeRed 0.8s ease-in-out; }
        @keyframes shakeRed { 0%, 100% { transform: translateX(0); filter: none; } 25% { transform: translateX(-15px); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.2); } 75% { transform: translateX(15px); filter: sepia(1) hue-rotate(-50deg) saturate(5) brightness(1.2); } }
        .crit-text { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); font-size: 3.5rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px currentColor; white-space: nowrap; z-index: 9999; pointer-events: none; animation: critPop 2.0s ease-out forwards; }
        @keyframes critPop { 0% { transform: translate(-50%, -50%) scale(0); opacity: 0; } 10% { transform: translate(-50%, -50%) scale(1.5); opacity: 1; } 20% { transform: translate(-50%, -50%) scale(1); } 80% { transform: translate(-50%, -50%) scale(1); opacity: 1; } 100% { transform: translate(-50%, -50%) scale(2); opacity: 0; } }
        .shaking-screen { animation: shakeBody 0.8s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shakeBody { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-8px, 0, 0); } 40%, 60% { transform: translate3d(8px, 0, 0); } }
        .floating-text { position: absolute; font-weight: 900; font-size: 1.5rem; animation: floatUp 3.0s forwards; pointer-events: none; z-index: 999; text-shadow: 1px 1px 0 #000; width: 100%; text-align: center; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-80px); opacity: 0; } }

        /* é€²åŒ–ç‰¹æ•ˆ */
        #evo-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 2000; display: none; flex-direction: column; justify-content: center; align-items: center; }
        .evo-img { width: 250px; height: 250px; object-fit: contain; z-index: 2001; }
        .sunburst { position: absolute; top: 50%; left: 50%; width: 600px; height: 600px; background: conic-gradient(from 0deg, transparent 0deg, rgba(255,255,255,0.2) 20deg, transparent 40deg, rgba(255,255,255,0.2) 60deg, transparent 80deg); transform: translate(-50%, -50%); animation: spin 10s linear infinite; display: none; }
        @keyframes spin { 100% { transform: translate(-50%, -50%) rotate(360deg); } }
        .anim-evo-phase1 { animation: evoPhase1 1.5s ease-in forwards; }
        @keyframes evoPhase1 { 0% { transform: scale(1); filter: brightness(1); } 100% { transform: scale(0.1) rotate(720deg); filter: brightness(50); } }
        .anim-evo-phase2 { animation: evoPhase2 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
        @keyframes evoPhase2 { 0% { transform: scale(0.1); filter: brightness(50); } 100% { transform: scale(1.2); filter: brightness(1); } }
        .evo-title { color: #f1c40f; font-size: 2.5rem; font-weight: 900; margin-top: 20px; z-index: 2001; opacity: 0; text-shadow: 0 0 10px #e67e22; width: 90%; text-align: center; }
        .fade-in { animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        
        /* è©³è§£èˆ‡çµç®— */
        .explanation-text { text-align: left; background: #fff3cd; color: #856404; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #ffeeba; line-height: 1.6; }
        .captain-img { width: 150px; height: 150px; object-fit: cover; border-radius: 50%; border: 5px solid #00509B; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .result-title { font-size: 1.8rem; font-weight: 900; margin-bottom: 10px; }
        .result-text { font-size: 1.2rem; margin-bottom: 20px; color: #333; font-weight: bold; }

        /* æ©«å¹…åœ–ç‰‡ */
        .hero-banner {
            width: 100%;
            max-width: 500px; 
            height: auto;
            max-height: 35vh; 
            object-fit: contain; 
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: block;
        }
    </style>
</head>
<body>

    <div id="crit-container"></div>
    <div id="evo-overlay">
        <div class="sunburst" id="evo-rays"></div>
        <img id="evo-img-display" class="evo-img" src="">
        <div id="evo-text" class="evo-title">ğŸ§¬ åŸºå› è¦ºé†’ï¼é€²åŒ–æˆåŠŸï¼</div>
        <button class="btn btn-light" id="evo-close-btn" style="margin-top:30px; z-index:2001; display:none;" onclick="UI.closeEvo()">âœ¨ æˆ°åŠ›å¤§å¹…æå‡ï¼</button>
    </div>

    <div id="modal-explanation" class="modal-overlay">
        <div class="quiz-box">
            <h2 style="color: #e74c3c;">âŒ ç­”éŒ¯äº†ï¼</h2>
            <div class="explanation-text" id="exp-content">è©³è§£è¼‰å…¥ä¸­...</div>
            <button class="btn btn-primary" onclick="UI.closeExplanation()">æˆ‘æ‡‚äº†ï¼Œä¸‹ä¸€é¡Œ</button>
        </div>
    </div>

    <div id="modal-battle-result" class="modal-overlay">
        <div class="quiz-box">
            <img id="result-captain-img" class="captain-img" src="" onerror="this.src='https://via.placeholder.com/150/000000/FFFFFF?text=Captain'">
            <div id="result-title" class="result-title"></div>
            <p id="result-text" class="result-text"></p>
            <button class="btn btn-green" onclick="location.reload()">å†æˆ°ä¸€å ´ (é‡æ–°æ•´ç†)</button>
        </div>
    </div>

    <div id="modal-story" class="modal-overlay">
        <div class="quiz-box" style="max-width: 500px; text-align: left;">
            <h2 id="story-title" style="color: var(--brand-primary); text-align: center;"></h2>
            <div style="text-align: center; margin: 10px 0;">
                <img id="story-img" src="" style="max-height: 150px; display: none; margin: 0 auto;">
            </div>
            <p id="story-text" style="line-height: 1.6; font-size: 1.05rem; color: #555; white-space: pre-line;"></p>
            <div style="margin-top: 20px; text-align: right;">
                <button id="story-btn-next" class="btn btn-green" onclick="Story.next()">ç¹¼çºŒ â¡ï¸</button>
                <button id="story-btn-close" class="btn btn-light" onclick="UI.hideModal('modal-story')" style="display:none;">é–‹å§‹ç‰¹è¨“ï¼ğŸš€</button>
            </div>
        </div>
    </div>

    <div id="screen-login" class="screen active" style="background: var(--brand-primary);">
        <img src="assets/hero_banner.png" class="hero-banner" onerror="this.src='https://via.placeholder.com/500x250/003366/FFFFFF?text=OBEAR+Academy';">
        <h1 style="color: white; margin-bottom: 20px; font-size: 1.8rem; text-shadow: 0 2px 4px rgba(0,0,0,0.3); text-align:center;">OBEAR æ˜Ÿéš›å­¸é™¢ v7.9.1</h1>
        
        <button class="btn btn-light" style="margin-bottom: 15px; font-size: 0.9rem;" onclick="Story.start()">ğŸ“– é ˜èˆªå“¡å…¥å­¸æ‰‹å†Š</button>
        
        <select id="course-select" class="course-selector" onchange="loadQuestionsByUrl(this.value)"></select>
        
        <div id="login-btns" style="display:flex; flex-direction:column; gap:10px; width:100%; align-items:center;"></div>
        
        <div style="color: rgba(255,255,255,0.5); font-size: 0.8rem; margin-top: 20px; text-align:center;">v7.9.1 è©³è§£ä¿®å¾©ç‰ˆ</div>
    </div>

    <div id="screen-home" class="screen">
        <div style="width: 100%; display:flex; justify-content:space-between; padding: 0 5px; flex-shrink:0;">
            <div style="background: var(--accent-gold); color: #7f6000; padding: 5px 12px; border-radius: 20px; font-weight: bold;">ğŸ’° <span id="ui-coins">0</span></div>
            <button onclick="SaveSystem.logout()" style="background:none; border:none; color:#999;">ç™»å‡º</button>
        </div>
        <div class="monster-stage">
            <img id="main-bear-img" class="monster-img" src="" onerror="this.style.display='none'; document.getElementById('fb-emoji').style.display='block';">
            <span id="fb-emoji" style="font-size:80px; display:none;">ğŸ§¸</span>
        </div>
        <div class="status-card">
            <div style="display:flex; justify-content:space-between; align-items:center; font-weight:bold; color:#00509B; margin-bottom: 5px;">
                <span id="ui-name" style="font-size: 1.2rem;">åŸåˆå°ç†Š</span>
                <span style="background:#eee; padding:2px 8px; border-radius:10px; font-size:0.8rem;">Lv.<span id="ui-lvl">1</span></span>
            </div>
            <div class="stats-row">
                <div class="stat-box">â¤ï¸ HP<br><span id="ui-stat-hp" class="stat-val" style="color:#e74c3c">120</span></div>
                <div class="stat-box">âš”ï¸ ATK<br><span id="ui-stat-atk" class="stat-val" style="color:#2980b9">15</span></div>
                <div class="stat-box">ğŸ›¡ï¸ TYPE<br><span id="ui-stat-type" class="stat-val">å‡è¡¡</span></div>
            </div>
            <div style="text-align:center; font-size:0.8rem; color:#666; margin: 5px 0; background: #f0f0f0; border-radius: 5px; padding: 3px;">
                ğŸ† å‹ç‡: <span id="ui-win-rate" style="font-weight:bold; color:#00509B;">0%</span> 
                (<span id="ui-wins">0</span>å‹ / <span id="ui-matches">0</span>æˆ°)
            </div>
            <div style="margin-top:5px; font-size:0.7rem;">EXP: <span id="ui-exp-val">0</span> / <span id="ui-max-exp">100</span></div>
            <div class="bar-container"><div class="bar-fill bar-exp" id="ui-exp-bar" style="width: 0%"></div></div>
        </div>
        <div style="margin-top: auto; width: 100%; display: flex; flex-direction: column; align-items: center; padding-bottom: 10px; flex-shrink:0;">
            <button class="btn btn-green" style="width:90%" onclick="Quiz.startTraining()">ğŸ“ æ¨¡æ“¬è€ƒç‰¹è¨“ (+$200)</button>
            <div style="display:flex; width:95%; gap:5px; justify-content:center;">
                <button class="btn btn-light" style="flex:1;" onclick="UI.showModal('modal-shop')">ğŸ›’ å­¸é™¢ç¦åˆ©ç¤¾</button>
                <button class="btn btn-red" style="flex:1;" onclick="Network.showLobby()">âš”ï¸ ç«¶æŠ€å ´å°æ±º</button>
            </div>
        </div>
    </div>

    <div id="modal-shop" class="modal-overlay" onclick="if(event.target===this) UI.hideModal('modal-shop')">
        <div class="quiz-box">
            <h2>ğŸ›’ å­¸é™¢ç¦åˆ©ç¤¾</h2>
            <button class="btn btn-red" onclick="Game.buyItem('meat')" style="width:100%">ğŸ¥© è‚‰è‚‰ ($100)</button>
            <button class="btn btn-green" onclick="Game.buyItem('honey')" style="width:100%">ğŸ¯ èœ‚èœœ ($200)</button>
            <hr>
            <p style="font-size:0.8rem; color:#888;">é€²åŒ–è·¯ç·šï¼š</p>
            <div style="display:flex; gap:5px;">
                <button class="btn btn-light" style="flex:1; font-size:0.8rem;" onclick="Game.setPath('speed')">âš¡ ç–¾é¢¨</button>
                <button class="btn btn-light" style="flex:1; font-size:0.8rem;" onclick="Game.setPath('def')">ğŸ›¡ï¸ é˜²ç¦¦</button>
                <button class="btn btn-light" style="flex:1; font-size:0.8rem;" onclick="Game.setPath('atk')">ğŸ”¥ æ”»æ“Š</button>
            </div>
            <button onclick="UI.hideModal('modal-shop')" style="margin-top:15px; border:none; background:none;">é—œé–‰</button>
        </div>
    </div>

    <div id="screen-lobby" class="screen" style="justify-content: center;">
        <h2>âš”ï¸ ç«¶æŠ€å ´å°æ±º</h2>
        <div class="status-card" style="text-align:center;">
            <p>ğŸ“¡ ä½ çš„é€šè¨Šé »æ®µï¼š</p>
            <div id="my-peer-id" style="font-size: 2rem; font-weight: bold; color: #00509B; border: 2px dashed #ccc; padding: 10px;">...</div>
        </div>
        <div style="margin: 10px; font-weight:bold; color:#ccc;">â€” æˆ– â€”</div>
        <div class="status-card" style="text-align:center;">
            <p>ğŸ”— è¼¸å…¥å°æ‰‹é »æ®µï¼š</p>
            <input type="text" id="join-id-input" style="font-size: 1.5rem; padding: 10px; width: 120px; text-align: center; border: 2px solid #ccc; border-radius: 8px;" placeholder="0000">
            <button class="btn btn-green" onclick="Network.joinGame()" style="width:100%; margin-top:10px;">é€£ç·šï¼</button>
        </div>
        <button onclick="UI.showScreen('screen-home')" style="margin-top: 20px; background:none; border:none; color:white;">è¿”å›</button>
    </div>

    <div id="screen-battle" class="screen">
        <div class="battle-half battle-top">
            <div class="battle-info">å°æ‰‹</div>
            <div class="bar-container" style="width:60%"><div id="enemy-hp" class="bar-fill bar-hp" style="width: 100%"></div></div>
            <img id="enemy-img" class="battle-avatar" src="" onerror="this.style.display='none'">
        </div>
        <div class="battle-msg" id="battle-msg">âš¡ æ­£åœ¨åŒæ­¥è…¦æ³¢è¨Šè™Ÿ...</div>
        <div class="battle-half battle-bottom">
            <img id="my-img" class="battle-avatar" src="" onerror="this.style.display='none'">
            <div class="bar-container" style="width:60%"><div id="my-hp" class="bar-fill bar-hp" style="width: 100%"></div></div>
            <div class="battle-info">ä½  (HP: <span id="battle-my-hp-val">0</span>)</div>
            <div class="battle-controls">
                <button class="btn btn-red" id="btn-attack" onclick="Battle.requestAttack()" style="width:80%; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);">âš¡ æ”»æ“Š</button>
            </div>
        </div>
        <button onclick="Network.disconnect()" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); color:white; border:none; padding: 5px 10px; border-radius:5px; z-index:90;">é€ƒè·‘</button>
    </div>

    <div id="modal-quiz" class="modal-overlay">
        <div class="quiz-box">
            <div id="q-content">
                <div style="font-size:0.9rem; color:#888; margin-bottom:5px;">è«‹ä½œç­”</div>
                <div id="q-text" style="font-size:1.5rem; font-weight:bold; margin-bottom:20px; line-height:1.4;">é¡Œç›®</div>
                <div id="q-options" class="options-grid"></div>
            </div>
            <div id="q-waiting" style="display:none; flex-direction:column; align-items:center;">
                <div style="font-size:3rem;">â³</div>
                <h3>å·²é–å®šç­”æ¡ˆ</h3>
                <p>ç­‰å¾…å°æ‰‹ä½œç­”ä¸­...</p>
            </div>
        </div>
    </div>

    <script>
        const AudioSys = {
            sounds: {
                correct: new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav'),
                wrong: new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/bonus.wav'),
                attack: new Audio('https://rpg.hamsterrepublic.com/wiki-images/d/db/Crush8-Bit.ogg'), 
                coin: new Audio('https://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/pause.wav'),
                evolve: new Audio('https://rpg.hamsterrepublic.com/wiki-images/d/d7/Oddbounce.ogg')
            },
            play(key) {
                try {
                    const s = this.sounds[key];
                    if(s) { s.currentTime = 0; s.play().catch(e => console.log("Audio play failed", e)); }
                } catch(e) { console.warn("Audio Error", e); }
            }
        };

        const COURSE_MENU = {
            "ğŸ“š åœ‹ä¸‰è‡ªç„¶è¤‡ç¿’": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCxrAze_6rnM3MXjNCO8UX1m12o3df8khWgJFVH0Fv9-lGqKQHaxucMCYT_lMay1kNUWH35l5NmQmB/pub?gid=0&single=true&output=csv",
            "âš›ï¸ é«˜äºŒç‰©ç†åŒ–å­¸": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCxrAze_6rnM3MXjNCO8UX1m12o3df8khWgJFVH0Fv9-lGqKQHaxucMCYT_lMay1kNUWH35l5NmQmB/pub?gid=1509348137&single=true&output=csv",
            "ğŸ”¬ åœ‹äºŒç†åŒ–": "https://docs.google.com/spreadsheets/d/e/2PACX-1vRCxrAze_6rnM3MXjNCO8UX1m12o3df8khWgJFVH0Fv9-lGqKQHaxucMCYT_lMay1kNUWH35l5NmQmB/pub?gid=680136498&single=true&output=csv"
        };

        const BEAR_DB = {
            baby:   { name: "åŸåˆå°ç†Š", type: 'balanced', img: 'assets/bear_baby.png', skillName: "æ†¤æ€’é ­æ§Œ !", skillColor: "#ffffff" },
            speed1: { name: "ç–¾é¢¨æˆ°ç†Š", type: 'balanced', img: 'assets/bear_speed_1.png', skillName: "éŸ³é€Ÿé€£æ–¬ !", skillColor: "#00ffff" },
            speed2: { name: "é–ƒå…‰ç†Šç¥", type: 'balanced', img: 'assets/bear_speed_2.png', skillName: "é›·éœ†è¬éˆ !", skillColor: "#ffd700" },
            def1:   { name: "é‡ç”²éµç†Š", type: 'def',      img: 'assets/bear_def_1.png', skillName: "é‡ç›¾çŒ›æ“Š !", skillColor: "#8d6e63" },
            def2:   { name: "å†°æ²³å·¨ç¥", type: 'def',      img: 'assets/bear_def_2.png', skillName: "çµ•å°é›¶åº¦ !", skillColor: "#e0f7fa" },
            atk1:   { name: "çˆ†ç‚é¬¥ç†Š", type: 'atk',      img: 'assets/bear_atk_1.png', skillName: "çˆ†è£‚ç«çƒ !", skillColor: "#ff5722" },
            atk2:   { name: "ç´…è“®æˆ°ç¥", type: 'atk',      img: 'assets/bear_atk_2.png', skillName: "ç´…è“®ç…‰ç„ !", skillColor: "#b71c1c" }
        };

        let QUESTIONS = [
            { q: "è¼‰å…¥ä¸­...", opts: ["...", "...", "...", "..."], a: 0, explanation: "ç„¡è©³è§£" }
        ];

        function loadQuestionsByUrl(url) {
            localStorage.setItem('obear_last_course_url', url);
            console.log("æ­£åœ¨è¼‰å…¥é¡Œåº«: " + url);
            fetch(url)
                .then(response => response.text())
                .then(text => {
                    const rows = text.split(/\r?\n/);
                    const newQuestions = [];
                    for (let i = 1; i < rows.length; i++) {
                        const row = rows[i].split(',');
                        if (row.length >= 6) {
                            newQuestions.push({
                                q: row[0],
                                opts: [row[1], row[2], row[3], row[4]],
                                a: parseInt(row[5]) - 1,
                                explanation: (row.length > 6 && row[6].trim() !== "") ? row[6] : "æœ¬é¡Œæš«ç„¡è©³è§£ã€‚"
                            });
                        }
                    }
                    if (newQuestions.length > 0) {
                        QUESTIONS = newQuestions;
                        console.log("âœ… æˆåŠŸè¼‰å…¥é¡Œåº«ï¼Œå…±", QUESTIONS.length, "é¡Œ");
                        const btn = document.querySelector('#course-select');
                        if(btn) btn.style.borderColor = '#78C878';
                    }
                })
                .catch(err => {
                    console.log("âŒ ç„¡æ³•è¼‰å…¥é¡Œåº«", err);
                    alert("é¡Œåº«è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–æ˜¯é€£çµè¨­å®šã€‚");
                });
        }

        function initCourseMenu() {
            const selectEl = document.getElementById('course-select');
            selectEl.innerHTML = '';
            const lastUrl = localStorage.getItem('obear_last_course_url');
            let isFirst = true;
            for (const [name, url] of Object.entries(COURSE_MENU)) {
                const opt = document.createElement('option');
                opt.value = url;
                opt.innerText = name;
                selectEl.appendChild(opt);
                if (url === lastUrl) { opt.selected = true; loadQuestionsByUrl(url); isFirst = false; }
            }
            if (isFirst) { const firstUrl = Object.values(COURSE_MENU)[0]; if(firstUrl) loadQuestionsByUrl(firstUrl); }
        }

        const SAVE_KEY = 'obear_save_v7_1';

        const SaveSystem = {
            data: null,
            getInitialData() { return { level: 1, exp: 0, maxExp: 100, coins: 0, formId: 'baby', path: 'speed', wins: 0, matches: 0 }; },
            checkSave() {
                const raw = localStorage.getItem(SAVE_KEY);
                const btnContainer = document.getElementById('login-btns');
                btnContainer.innerHTML = ''; 
                if (raw) {
                    this.data = JSON.parse(raw);
                    const btnCont = document.createElement('button');
                    btnCont.className = 'btn btn-green';
                    btnCont.style.width = '200px';
                    btnCont.innerText = `ç¹¼çºŒå†’éšª (Lv.${this.data.level})`;
                    btnCont.onclick = () => { UI.updateHome(); UI.showScreen('screen-home'); };
                    btnContainer.appendChild(btnCont);
                    
                    const btnReset = document.createElement('button');
                    btnReset.className = 'btn btn-light';
                    btnReset.style.width = '200px';
                    btnReset.innerText = 'é‡æ–°é–‹å§‹';
                    btnReset.onclick = () => { if(confirm('ç¢ºå®šè¦åˆªé™¤é€²åº¦å—ï¼Ÿ')) this.initGame(true); };
                    btnContainer.appendChild(btnReset);
                } else {
                    const btnNew = document.createElement('button');
                    btnNew.className = 'btn btn-green';
                    btnNew.style.width = '200px';
                    btnNew.innerText = 'é–‹å§‹æ–°éŠæˆ²';
                    btnNew.onclick = () => this.initGame(true);
                    btnContainer.appendChild(btnNew);
                }
            },
            initGame(isNew) {
                if(isNew) { this.data = this.getInitialData(); this.save(); }
                UI.updateHome(); UI.showScreen('screen-home');
            },
            save() { if(this.data) localStorage.setItem(SAVE_KEY, JSON.stringify(this.data)); UI.updateHome(); },
            logout() { location.reload(); }
        };

        function getStats(formId, level) {
            const bear = BEAR_DB[formId] || BEAR_DB['baby'];
            let hpMult = 1.0, atkMult = 1.0, typeName = "å‡è¡¡";
            if (bear.type === 'def') { hpMult = 1.5; atkMult = 0.8; typeName = "é˜²ç¦¦"; }
            if (bear.type === 'atk') { hpMult = 0.8; atkMult = 1.5; typeName = "æ”»æ“Š"; }
            const baseHp = 100 + (level * 20);
            const baseAtk = 10 + (level * 5);
            return { hp: Math.floor(baseHp * hpMult), atk: Math.floor(baseAtk * atkMult), type: typeName };
        }

        const Game = {
            setPath(pathType) { SaveSystem.data.path = pathType; alert("è¨­å®šè·¯ç·šï¼š" + pathType); },
            buyItem(item) {
                const d = SaveSystem.data;
                let cost = (item === 'meat') ? 100 : 200;
                let gain = (item === 'meat') ? 50 : 120;
                if (d.coins >= cost) { d.coins -= cost; AudioSys.play('coin'); this.gainExp(gain); } else { alert("éŒ¢ä¸å¤ ï¼"); }
                SaveSystem.save();
            },
            gainExp(amount) {
                const d = SaveSystem.data;
                d.exp += amount;
                if (d.exp >= d.maxExp) {
                    d.level++; d.exp -= d.maxExp; d.maxExp = Math.floor(d.maxExp * 1.5);
                    UI.showFloat(`å‡ç´šï¼Lv.${d.level}`, '#f1c40f');
                    AudioSys.play('evolve'); 
                    const p = d.path || 'speed';
                    if (d.level === 10) { if(p==='speed') this.evolve('speed1'); if(p==='def') this.evolve('def1'); if(p==='atk') this.evolve('atk1'); }
                    if (d.level === 30) { if(p==='speed') this.evolve('speed2'); if(p==='def') this.evolve('def2'); if(p==='atk') this.evolve('atk2'); }
                }
                SaveSystem.save();
            },
            evolve(newId) {
                const oldId = SaveSystem.data.formId;
                setTimeout(() => { UI.playEvolutionAnim(oldId, newId, BEAR_DB[newId].name); SaveSystem.data.formId = newId; SaveSystem.save(); }, 1000);
            }
        };

        const UI = {
            showScreen(id) { document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); },
            showModal(id) { document.getElementById(id).style.display = 'flex'; },
            hideModal(id) { document.getElementById(id).style.display = 'none'; },
            
            closeExplanation() {
                document.getElementById('modal-explanation').style.display = 'none';
                this.hideModal('modal-quiz'); 
            },

            showBattleResult(isWin) {
                const modal = document.getElementById('modal-battle-result');
                const img = document.getElementById('result-captain-img');
                const title = document.getElementById('result-title');
                const text = document.getElementById('result-text');

                if (isWin) {
                    img.src = 'assets/captain_win.png';
                    title.innerText = "ğŸ† æˆ°é¬¥å‹åˆ©ï¼";
                    title.style.color = "#f1c40f";
                    text.innerText = "æ­å–œä½ ï¼Œä¸æ„§æ˜¯é»‘ç†Šçš„å­¸ç”Ÿï¼ï¼ï¼";
                } else {
                    img.src = 'assets/captain_lose.png';
                    title.innerText = "ğŸ’” æˆ°é¬¥å¤±æ•—...";
                    title.style.color = "#e74c3c";
                    text.innerText = "ä¸Šå¸æ˜¯å…¬å¹³çš„ï¼Œä½ é•·é€™æ¨£ï¼Œä¸€å®šå­¸çš„èµ·ä¾†";
                }
                modal.style.display = 'flex';
            },

            updateHome() {
                const d = SaveSystem.data;
                const bear = BEAR_DB[d.formId] || BEAR_DB['baby'];
                const stats = getStats(d.formId, d.level);
                document.getElementById('ui-coins').innerText = d.coins;
                document.getElementById('ui-name').innerText = bear.name;
                document.getElementById('ui-lvl').innerText = d.level;
                document.getElementById('main-bear-img').src = bear.img; 
                document.getElementById('main-bear-img').style.display = 'block'; 
                document.getElementById('fb-emoji').style.display='none';
                document.getElementById('ui-stat-hp').innerText = stats.hp;
                document.getElementById('ui-stat-atk').innerText = stats.atk;
                document.getElementById('ui-stat-type').innerText = stats.type;
                document.getElementById('ui-exp-val').innerText = d.exp;
                document.getElementById('ui-max-exp').innerText = d.maxExp;
                document.getElementById('ui-exp-bar').style.width = (d.exp/d.maxExp)*100 + "%";

                const wins = d.wins || 0;
                const matches = d.matches || 0;
                const rate = matches === 0 ? 0 : Math.round((wins / matches) * 100);
                document.getElementById('ui-win-rate').innerText = rate + "%";
                document.getElementById('ui-wins').innerText = wins;
                document.getElementById('ui-matches').innerText = matches;
            },
            showFloat(text, color='#f1c40f') {
                const el = document.createElement('div');
                el.innerText = text; el.className = 'floating-text'; el.style.color = color;
                el.style.left = '0'; el.style.top = '40%';
                document.body.appendChild(el);
                AudioSys.play('coin'); 
                setTimeout(()=>el.remove(), 3000);
            },
            showCrit(skillName, color) {
                const container = document.getElementById('crit-container');
                container.innerHTML = '';
                const el = document.createElement('div');
                el.className = 'crit-text';
                el.innerText = skillName;
                el.style.color = color;
                el.style.textShadow = `0 0 20px ${color}`;
                container.appendChild(el);
                setTimeout(() => container.innerHTML = '', 3000);
                document.body.classList.add('shaking-screen');
                setTimeout(() => document.body.classList.remove('shaking-screen'), 800);
            },
            playEvolutionAnim(oldId, newId, newName) {
                const overlay = document.getElementById('evo-overlay');
                const img = document.getElementById('evo-img-display');
                const title = document.getElementById('evo-text');
                const btn = document.getElementById('evo-close-btn');
                const rays = document.getElementById('evo-rays');
                
                AudioSys.play('evolve'); 

                overlay.style.display = 'flex'; img.src = BEAR_DB[oldId].img; img.className = 'evo-img anim-evo-phase1'; 
                title.style.opacity = '0'; btn.style.display = 'none'; rays.style.display = 'none';
                setTimeout(() => { img.src = BEAR_DB[newId].img; img.className = 'evo-img anim-evo-phase2'; rays.style.display = 'block'; }, 1500);
                setTimeout(() => { title.innerText = `ğŸ§¬ åŸºå› è¦ºé†’ï¼${newName}`; title.classList.add('fade-in'); btn.style.display = 'block'; btn.classList.add('fade-in'); }, 2300);
            },
            closeEvo() { document.getElementById('evo-overlay').style.display = 'none'; this.updateHome(); },
            
            animAttack(isMe) {
                const id = isMe ? 'my-img' : 'enemy-img';
                const cls = isMe ? 'anim-atk-up' : 'anim-atk-down';
                const el = document.getElementById(id);
                el.classList.remove(cls); void el.offsetWidth; el.classList.add(cls);
                AudioSys.play('attack'); 
            },
            animDamage(isMe) {
                const id = isMe ? 'my-img' : 'enemy-img';
                const el = document.getElementById(id);
                el.classList.remove('anim-dmg'); void el.offsetWidth; el.classList.add('anim-dmg');
            }
        };

        const Network = {
            peer: null, conn: null, myId: null,
            init() {
                const randomId = Math.floor(1000 + Math.random() * 9000).toString();
                this.peer = new Peer(randomId);
                this.peer.on('open', id => { this.myId = id; document.getElementById('my-peer-id').innerText = id; });
                this.peer.on('connection', conn => { this.setup(conn); setTimeout(() => this.sendInfo(true), 1000); }); 
            },
            showLobby() { UI.showScreen('screen-lobby'); if(!this.peer) this.init(); },
            joinGame() {
                const id = document.getElementById('join-id-input').value;
                if(!id) return alert("è«‹è¼¸å…¥æˆ¿è™Ÿ");
                const conn = this.peer.connect(id);
                this.setup(conn);
            },
            setup(conn) {
                this.conn = conn;
                conn.on('open', () => this.sendInfo(false)); 
                conn.on('data', data => this.handle(data));
                conn.on('close', () => { alert("å°æ–¹æ–·ç·š"); UI.showScreen('screen-home'); });
            },
            send(data) { if(this.conn && this.conn.open) this.conn.send(data); },
            sendInfo(isHost) {
                const d = SaveSystem.data;
                const s = getStats(d.formId, d.level);
                this.send({ type: 'INFO', formId: d.formId, maxHp: s.hp, atk: s.atk, isHost: isHost });
            },
            handle(data) {
                if(data.type === 'INFO') {
                    Battle.enemyHp = data.maxHp;
                    Battle.enemyMaxHp = data.maxHp;
                    Battle.enemyAtk = data.atk;
                    Battle.enemyFormId = data.formId;
                    const enemyImg = document.getElementById('enemy-img');
                    enemyImg.src = BEAR_DB[data.formId] ? BEAR_DB[data.formId].img : BEAR_DB['baby'].img;
                    enemyImg.style.display = 'block'; 
                    Battle.init(data.isHost); 
                }
                if(data.type === 'NEW_ROUND') Battle.startRound(data.qIdx);
                if(data.type === 'ANSWER') Battle.handleClientAnswer(data.correct, data.time);
                if(data.type === 'RESULT') Battle.applyResult(data);
            },
            disconnect() { if(this.conn) this.conn.close(); location.reload(); }
        };

        const Battle = {
            myHp: 0, myMaxHp: 0, myAtk: 0,
            enemyHp: 0, enemyMaxHp: 0, enemyAtk: 0, enemyFormId: 'baby',
            isHost: false, hostStreak: 0, clientStreak: 0, myMove: null, clientMove: null, 
            init(opponentIsHost) {
                this.isHost = !opponentIsHost; 
                const d = SaveSystem.data;
                const s = getStats(d.formId, d.level);
                this.myHp = s.hp; this.myMaxHp = s.hp; this.myAtk = s.atk;
                this.hostStreak = 0; this.clientStreak = 0;
                const myImg = document.getElementById('my-img');
                myImg.src = BEAR_DB[d.formId].img;
                myImg.style.display = 'block'; 
                document.getElementById('battle-my-hp-val').innerText = this.myHp;
                this.updateUI();
                UI.showScreen('screen-battle');
                if(this.isHost) setTimeout(() => this.broadcastNewRound(), 2000);
                else document.getElementById('battle-msg').innerText = "ç­‰å¾…æˆ¿ä¸»é–‹å§‹...";
            },
            broadcastNewRound() {
                const qIdx = Math.floor(Math.random() * QUESTIONS.length);
                Network.send({ type: 'NEW_ROUND', qIdx: qIdx });
                this.startRound(qIdx);
            },
            startRound(qIdx) {
                this.myMove = null; this.clientMove = null;
                document.getElementById('battle-msg').innerText = "æˆ°é¬¥é–‹å§‹ï¼";
                Quiz.show(qIdx, true); 
            },
            submitMove(isCorrect, timeUsed) {
                this.myMove = { correct: isCorrect, time: timeUsed };
                document.getElementById('battle-msg').innerText = "å·²æ”»æ“Šï¼Œç­‰å¾…å°æ‰‹...";
                if(this.isHost) this.checkRoundEnd();
                else Network.send({ type: 'ANSWER', correct: isCorrect, time: timeUsed });
            },
            handleClientAnswer(correct, time) {
                this.clientMove = { correct: correct, time: time };
                this.checkRoundEnd();
            },
            checkRoundEnd() {
                if(this.myMove && this.clientMove) {
                    const p1 = this.myMove; const p2 = this.clientMove;
                    let res = { winner: 'none', dmg: 0, isCrit: false, skillName: '', skillColor: '' };
                    let winner = 'none';
                    if(p1.correct && !p2.correct) winner = 'host';
                    else if (!p1.correct && p2.correct) winner = 'client';
                    else if (!p1.correct && !p2.correct) winner = 'both_wrong';
                    else { if(p1.time < p2.time) winner = 'host'; else winner = 'client'; }

                    res.winner = winner;
                    if (winner === 'host') {
                        this.hostStreak++; this.clientStreak = 0; res.dmg = this.myAtk;
                        if (this.hostStreak >= 3) { res.isCrit = true; res.dmg *= 2; this.hostStreak = 0; const skill = BEAR_DB[SaveSystem.data.formId] || BEAR_DB['baby']; res.skillName = skill.skillName; res.skillColor = skill.skillColor; }
                    } else if (winner === 'client') {
                        this.clientStreak++; this.hostStreak = 0; res.dmg = this.enemyAtk;
                        if (this.clientStreak >= 3) { res.isCrit = true; res.dmg *= 2; this.clientStreak = 0; const skill = BEAR_DB[this.enemyFormId] || BEAR_DB['baby']; res.skillName = skill.skillName; res.skillColor = skill.skillColor; }
                    } else { this.hostStreak = 0; this.clientStreak = 0; res.dmg = Math.floor(this.myMaxHp * 0.1); }
                    this.applyResult(res); Network.send({ type: 'RESULT', ...res }); 
                    setTimeout(() => this.broadcastNewRound(), res.isCrit ? 5000 : 4000); 
                }
            },
            applyResult(res) {
                UI.hideModal('modal-quiz');
                const HIT_DELAY = 500; 
                if(res.winner === 'both_wrong') {
                    UI.showFloat("é›™æ–¹å¤±èª¤ï¼è‡ªçˆ†ï¼", '#e74c3c');
                    AudioSys.play('wrong'); 
                    this.myHp -= res.dmg; this.enemyHp -= res.dmg; 
                    UI.animDamage(true); UI.animDamage(false);
                    this.updateUI(); this.checkWin();
                } else {
                    const iAmWinner = (this.isHost && res.winner === 'host') || (!this.isHost && res.winner === 'client');
                    if (res.isCrit) UI.showCrit(res.skillName, res.skillColor);
                    if(iAmWinner) {
                        UI.animAttack(true); 
                        setTimeout(() => { UI.showFloat(`æ”»æ“ŠæˆåŠŸï¼ -${res.dmg}`, '#f1c40f'); UI.animDamage(false); this.enemyHp -= res.dmg; this.updateUI(); this.checkWin(); }, HIT_DELAY); 
                    } else {
                        UI.animAttack(false);
                        setTimeout(() => { UI.showFloat(`è¢«æ“Šä¸­... -${res.dmg}`, '#c0392b'); UI.animDamage(true); this.myHp -= res.dmg; this.updateUI(); this.checkWin(); }, HIT_DELAY);
                    }
                }
            },
            checkWin() {
                if(this.myHp <= 0 || this.enemyHp <= 0) { SaveSystem.data.matches = (SaveSystem.data.matches || 0) + 1; }
                if(this.myHp <= 0) { SaveSystem.save(); setTimeout(() => { UI.showBattleResult(false); }, 1500); }
                else if(this.enemyHp <= 0) { SaveSystem.data.coins += 1000; SaveSystem.data.wins = (SaveSystem.data.wins || 0) + 1; SaveSystem.save(); setTimeout(() => { UI.showBattleResult(true); }, 1500); }
            },
            updateUI() {
                document.getElementById('my-hp').style.width = Math.max(0, (this.myHp/this.myMaxHp)*100) + "%";
                document.getElementById('enemy-hp').style.width = Math.max(0, (this.enemyHp/this.enemyMaxHp)*100) + "%";
                document.getElementById('battle-my-hp-val').innerText = Math.max(0, this.myHp);
            }
        };

        const Quiz = {
            startTime: 0, isPvp: false, currentQ: null, isLocked: false,
            startTraining() { this.isPvp = false; this.show(0, false); },
            show(qIdx, isPvp) {
                this.isPvp = isPvp;
                this.isLocked = false; 
                this.currentQ = (isPvp) ? QUESTIONS[qIdx] : QUESTIONS[Math.floor(Math.random()*QUESTIONS.length)];
                document.getElementById('q-content').style.display = 'block';
                document.getElementById('q-waiting').style.display = 'none';
                document.getElementById('q-text').innerText = this.currentQ.q;
                const grid = document.getElementById('q-options');
                grid.innerHTML = ''; 
                this.startTime = Date.now();
                this.currentQ.opts.forEach((opt, idx) => {
                    const btn = document.createElement('button');
                    btn.className = 'opt-btn';
                    btn.innerText = opt;
                    btn.onclick = () => this.answer(idx, this.currentQ.a, btn);
                    grid.appendChild(btn);
                });
                UI.showModal('modal-quiz');
            },
            answer(idx, correctIdx, btnElement) {
                if (this.isLocked) return;
                const timeUsed = Date.now() - this.startTime;
                const isCorrect = (idx === correctIdx);
                if(!this.isPvp) {
                    this.isLocked = true; 
                    if(isCorrect) { 
                        btnElement.style.background = '#d4edda'; btnElement.style.border = '2px solid #28a745';
                        AudioSys.play('correct'); SaveSystem.data.coins += 200; SaveSystem.save(); UI.showFloat("ğŸ’° +$200"); 
                        setTimeout(() => { UI.hideModal('modal-quiz'); }, 1000);
                    } else { 
                        // â–¼â–¼â–¼ é—œéµä¿®æ­£ï¼šç­”éŒ¯æµç¨‹ â–¼â–¼â–¼
                        btnElement.style.background = '#f8d7da'; btnElement.style.border = '2px solid #dc3545';
                        AudioSys.play('wrong');
                        setTimeout(() => { 
                            // 1. å…ˆé—œé–‰é¡Œç›®è¦–çª—ï¼Œé¿å…é®æ“‹
                            UI.hideModal('modal-quiz');
                            
                            // 2. è¨­å®šè©³è§£å…§å®¹
                            const expText = this.currentQ.explanation || "æœ¬é¡Œæš«ç„¡è©³è§£";
                            document.getElementById('exp-content').innerHTML = expText;
                            
                            // 3. é–‹å•Ÿè©³è§£è¦–çª—
                            UI.showModal('modal-explanation'); 
                        }, 1000);
                    }
                } else {
                    document.getElementById('q-content').style.display = 'none';
                    document.getElementById('q-waiting').style.display = 'flex';
                    Battle.submitMove(isCorrect, timeUsed);
                }
            }
        };

        const Story = {
            step: 0,
            content: [
                { title: "ğŸ‘‹ æ­¡è¿ä¾†åˆ°å­¸é™¢", text: "å—¨ï¼Œæ–°ä¾†çš„é ˜èˆªå“¡ï¼æ­¡è¿ä¾†åˆ°å…¨å®‡å®™æœ€é ‚å°–çš„å­¸åºœâ€”â€”ã€Obear æ˜Ÿéš›å­¸é™¢ã€ã€‚\n\nåœ¨é€™è£¡ï¼Œæˆ‘å€‘ä¸æ¯”è‚Œè‚‰ï¼Œæ¯”çš„æ˜¯å¤§è…¦çš„é‹è½‰é€Ÿåº¦ï¼\nä½ æ˜¯å¦å·²ç¶“æº–å‚™å¥½ï¼Œé ˜å–é‚£éš»å±¬æ–¼ä½ çš„å¤¥ä¼´äº†å‘¢ï¼Ÿ", img: null },
                { title: "ğŸ§¸ é—œæ–¼ä½ çš„å¤¥ä¼´", text: "çœ‹ï¼é€™éš»çœ‹èµ·ä¾†å‘†å‘†çš„ã€æ­£åœ¨åƒæ‰‹æŒ‡çš„å®¶å¤¥ï¼Œå°±æ˜¯ä½ çš„æ­æª”â€”â€”ã€åŸåˆå°ç†Šã€ã€‚\n\nåˆ¥çœ‹å®ƒç¾åœ¨åªæœ‰ Lv.1ï¼Œå®ƒçš„åŸºå› è£¡å¯æ˜¯éš±è—è‘—çµ±æ²»å®‡å®™çš„åŠ›é‡ã€‚ä½†é€™è‚¡åŠ›é‡æ­£åœ¨æ²‰ç¡ï¼Œåªæœ‰ä¸€ç¨®æ±è¥¿èƒ½å–šé†’å®ƒ......\n\né‚£å°±æ˜¯**ã€æ­£ç¢ºçš„çŸ¥è­˜ã€**ï¼", img: "assets/bear_baby.png" },
                { title: "ğŸ“œ å­¸é™¢ç”Ÿå­˜æ³•å‰‡", text: "èº«ç‚ºå­¸é™¢çš„ä¸€ä»½å­ï¼Œä½ å¿…é ˆç‰¢è¨˜ä»¥ä¸‹ä¸‰æ¢éµå¾‹ï¼š\n\n1ï¸âƒ£ **çŸ¥è­˜å³æ˜¯è²¡å¯Œ**ï¼šå»ã€æ¨¡æ“¬è€ƒç‰¹è¨“ã€ç­”é¡Œè³ºé‡‘å¹£ï¼\n2ï¸âƒ£ **åƒé£½æ‰æœ‰åŠ›æ°£**ï¼šå»ã€ç¦åˆ©ç¤¾ã€è²·è‚‰è‚‰é€²åŒ–ï¼ä½ çš„åŸ¹è‚²æ±ºå®šå®ƒçš„å‹æ…‹ï¼ˆç–¾é¢¨/é˜²ç¦¦/æ”»æ“Šï¼‰ã€‚\n3ï¸âƒ£ **å¯¦æˆ°æª¢é©—çœŸç†**ï¼šå»ã€ç«¶æŠ€å ´ã€èˆ‡åŒå­¸é€£ç·šï¼Œè…¦æ³¢åŒæ­¥ç‡è¶Šé«˜ï¼Œè¶Šèƒ½é‡‹æ”¾å¿…æ®ºæŠ€ï¼", img: null },
                { title: "ğŸš€ æº–å‚™å¥½äº†å—ï¼Ÿ", text: "è§£èªªçµæŸã€‚\n\nä½ çš„åŸåˆå°ç†Šæ­£çœ¼å·´å·´åœ°çœ‹è‘—ä½ ï¼Œå®ƒçš„è‚šå­å·²ç¶“åœ¨å’•åš•å’•åš•å«äº†ã€‚\n\nè¦ªæ„›çš„é ˜èˆªå“¡ï¼Œç¾åœ¨å°±ç™»å…¥ç³»çµ±ï¼Œé–‹å§‹ä½ çš„ç¬¬ä¸€å ‚èª²å§ï¼", img: null }
            ],
            start() { this.step = 0; UI.showModal('modal-story'); this.render(); },
            next() { this.step++; if (this.step >= this.content.length) { UI.hideModal('modal-story'); } else { this.render(); } },
            render() {
                const data = this.content[this.step];
                document.getElementById('story-title').innerText = data.title;
                let formattedText = data.text.replace(/\*\*(.*?)\*\*/g, '<b style="color:#d35400">$1</b>');
                document.getElementById('story-text').innerHTML = formattedText;
                const imgEl = document.getElementById('story-img');
                if(data.img) { imgEl.src = data.img; imgEl.style.display = 'block'; } else { imgEl.style.display = 'none'; }
                if (this.step === this.content.length - 1) { document.getElementById('story-btn-next').style.display = 'none'; document.getElementById('story-btn-close').style.display = 'inline-block'; } 
                else { document.getElementById('story-btn-next').style.display = 'inline-block'; document.getElementById('story-btn-close').style.display = 'none'; }
            }
        };

        SaveSystem.checkSave();
        initCourseMenu(); 

    </script>
</body>
</html>